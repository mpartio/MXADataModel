# Building

The purpose of this fork of MXADataModel is to enable builds on RHEL8/gcc8.

Build process:

```
dnf install libexpat-devel libtiff-devel boost169-devel libhdf5-devel cmake3
git clone git@github.com:mpartio/MXADataModel.git
git clone git@github.com:BlueQuartzSoftware/CMP.git
cd MXADataModel
mkdir build && cd build
cmake3 -DBUILD_SHARED_LIBS=OFF -DBOOST_INCLUDEDIR=/usr/include/boost169 -DBOOST_LIBRARYDIR=/usr/boost169/lib -DCMP_HAVE_SYS_TIME_GETTIMEOFDAY=ON -DCMP_HAVE_SYS_STAT_H=ON -DMXA_HDF5_SUPPORT=ON -Wno-dev ..
make
```

At this point compilation fails, unless QT is installed:

```
In file included from /home/dev/partio/other/MXADataModel.orig/Code/MXA/HDF5/H5TiffIO.cpp:35:
/home/dev/partio/other/MXADataModel.orig/build/MXA/MXAVersion.h:9:10: fatal error: QtCore/QString: No such file or directory
 #include <QtCore/QString>
          ^~~~~~~~~~~~~~~~
```

Apply this patch:

```
--- ../../MXADataModel.orig/build/MXA/MXAVersion.h	2020-08-26 10:42:28.482805223 +0300
+++ ./MXA/MXAVersion.h	2020-08-26 10:40:36.429151803 +0300
@@ -1,12 +1,12 @@
 /*--------------------------------------------------------------------------
- * This file is autogenerated from /home/dev/partio/other/MXADataModel.orig/../CMP/ConfiguredFiles/cmpVersion.h.in during the cmake
+ * This file is autogenerated from /home/dev/partio/other/MXADataModel/../CMP/ConfiguredFiles/cmpVersion.h.in during the cmake
  * configuration of your project. If you need to make changes, edit the
  * original file NOT THIS FILE.
  * --------------------------------------------------------------------------*/
 
 #pragma once
 
-#include <QtCore/QString>
+#include <string>
  
 
 
@@ -14,14 +14,14 @@
 {
   namespace Version
   {
-     QString Complete();
-     QString Major();
-     QString Minor();
-     QString Patch();
-     QString Package();
-     QString Revision();
-     QString PackageComplete();
-     QString BuildDate();
-     QString GitHash();
+     std::string Complete();
+     std::string Major();
+     std::string Minor();
+     std::string Patch();
+     std::string Package();
+     std::string Revision();
+     std::string PackageComplete();
+     std::string BuildDate();
+     std::string GitHash();
   };
 }
--- ../../MXADataModel.orig/build/MXA/MXAVersion.cpp	2020-08-26 10:42:28.483805238 +0300
+++ ./MXA/MXAVersion.cpp	2020-08-26 10:40:57.429461675 +0300
@@ -1,10 +1,10 @@
 /*--------------------------------------------------------------------------
- * This file is autogenerated from /home/dev/partio/other/MXADataModel.orig/../CMP/ConfiguredFiles/cmpVersion.cpp.in during the cmake
+ * This file is autogenerated from /home/dev/partio/other/MXADataModel/../CMP/ConfiguredFiles/cmpVersion.cpp.in during the cmake
  * configuration of your project. If you need to make changes, edit the
  * original file NOT THIS FILE.
  * --------------------------------------------------------------------------*/
 
-#include "/home/dev/partio/other/MXADataModel.orig/build/MXA/MXAVersion.h"
+#include "/home/dev/partio/other/MXADataModel/build/MXA/MXAVersion.h"
 
 /* Definition of version number for  */
 #define _PACKAGE_NAME     ""
@@ -19,71 +19,71 @@
 // -----------------------------------------------------------------------------
 //
 // -----------------------------------------------------------------------------
-QString MXA::Version::Complete()
+std::string MXA::Version::Complete()
 { 
-  return QString("..0.0");
+  return std::string("..0.0");
 }
 
 // -----------------------------------------------------------------------------
 //
 // -----------------------------------------------------------------------------
-QString MXA::Version::Major()
+std::string MXA::Version::Major()
 { 
-  return QString("");
+  return std::string("");
 }
 
 // -----------------------------------------------------------------------------
 //
 // -----------------------------------------------------------------------------
-QString MXA::Version::Minor()
+std::string MXA::Version::Minor()
 { 
-  return QString("");
+  return std::string("");
 }
 
 // -----------------------------------------------------------------------------
 //
 // -----------------------------------------------------------------------------
-QString MXA::Version::Patch()
+std::string MXA::Version::Patch()
 { 
-  return QString("0");
+  return std::string("0");
 }
 
 // -----------------------------------------------------------------------------
 //
 // -----------------------------------------------------------------------------
-QString MXA::Version::Revision()
+std::string MXA::Version::Revision()
 { 
-  return QString("0");
+  return std::string("0");
 }
 
 // -----------------------------------------------------------------------------
 //
 // -----------------------------------------------------------------------------
-QString MXA::Version::Package()
+std::string MXA::Version::Package()
 { 
-  return QString("..0");
+  return std::string("..0");
 }
 
 // -----------------------------------------------------------------------------
 //
 // -----------------------------------------------------------------------------
-QString MXA::Version::PackageComplete()
+std::string MXA::Version::PackageComplete()
 { 
-  return QString(" Version ..0.0");
+  return std::string(" Version ..0.0");
 }
 
 // -----------------------------------------------------------------------------
 //
 // -----------------------------------------------------------------------------
-QString MXA::Version::BuildDate()
+std::string MXA::Version::BuildDate()
 { 
-  return QString("");
+  return std::string("");
 }
 
 // -----------------------------------------------------------------------------
 //
 // -----------------------------------------------------------------------------
-QString MXA::Version::GitHash()
+std::string MXA::Version::GitHash()
 { 
-  return QString("0x000000000000000000000000000000");
+  return std::string("0x000000000000000000000000000000");
 }
```

```
patch -p0 < patchfile
make
```

# Building RPM

```
cpack3 -G RPM -DCPACK_COMPONENTS_ALL
```

If the contents of the rpm are not suitable, it can be adjusted:

```
mkdir -p _CPack_Packages/Linux/RPM/MXADataModel-Linux/usr/bin
mv _CPack_Packages/Linux/RPM/MXADataModel-Linux/usr/tools/* _CPack_Packages/Linux/RPM/MXADataModel-Linux/usr/bin
cp ./Bin/libMXADataModel.a _CPack_Packages/Linux/RPM/MXADataModel-Linux/usr/lib/
mkdir -p _CPack_Packages/Linux/RPM/MXADataModel-Linux/usr/include/MXA
cp -r ../Code/MXA _CPack_Packages/Linux/RPM/MXADataModel-Linux/usr/include
find _CPack_Packages/Linux/RPM/MXADataModel-Linux/usr/include/MXA/ -name "*.cpp" -delete
```

Edit spec file accordingly (%files section).

```
--- _CPack_Packages/Linux/RPM/SPECS/mxadatamodel.spec.orig	2020-08-26 11:04:36.936373206 +0300
+++ _CPack_Packages/Linux/RPM/SPECS/mxadatamodel.spec	2020-08-26 11:05:50.876462000 +0300
@@ -93,17 +93,17 @@
 "/usr/share/MXADataModel/Resources/Templates/ImportDelegateFactory.cpp.in"
 "/usr/share/MXADataModel/Resources/Templates/ImportDelegateFactory.h.in"
 "/usr/share/MXADataModel/Resources/Templates/main.cpp.in"
-%dir "/usr/tools"
-"/usr/tools/DataImportExample"
-"/usr/tools/DataWrapperExample"
-"/usr/tools/Example1"
-"/usr/tools/Example2"
-"/usr/tools/GetDataExample"
-"/usr/tools/ImportGenerator"
-"/usr/tools/MXAPropertyExample"
-"/usr/tools/SupportFileExample"
-
-
+"/usr/bin/DataImportExample"
+"/usr/bin/DataWrapperExample"
+"/usr/bin/Example1"
+"/usr/bin/Example2"
+"/usr/bin/GetDataExample"
+"/usr/bin/ImportGenerator"
+"/usr/bin/MXAPropertyExample"
+"/usr/bin/SupportFileExample"
+%dir "/usr/include/MXA"
+"/usr/include/MXA/*"
+"/usr/lib/libMXADataModel.a"
 
 
 %changelog
```

Build again:

```
rpmbuild -bb --buildroot $(pwd)/_CPack_Packages/Linux/RPM/MXADataModel-Linux _CPack_Packages/Linux/RPM/SPECS/mxadatamodel.spec
```
